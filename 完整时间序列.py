import numpy as np
from scipy.signal import savgol_filter
from matplotlib import pyplot
import matplotlib.pyplot as plt
import matplotlib
from matplotlib import pyplot
matplotlib.use('TkAgg')
from scipy import signal  

dit={'2021-01-05': 0.061689002, '2021-01-06': 0.057679739, '2021-01-07': 0.0556, '2021-01-08': 0.055486651, '2021-01-09': 0.0572, '2021-01-10': 0.0602, '2021-01-11': 0.0637, '2021-01-12': 0.0672, '2021-01-13': 0.07, '2021-01-14': 0.0714, '2021-01-15': 0.0706, '2021-01-16': 0.0672, '2021-01-17': 0.060273537, '2021-01-18': 0.0515, '2021-01-19': 0.050925331, '2021-01-20': 0.0639, '2021-01-21': 0.067401093, '2021-01-22': 0.047557215, '2021-01-23': 0.0428, '2021-01-24': 0.0528, '2021-01-25': 0.0632, '2021-01-26': 0.059730178, '2021-01-27': 0.0385, '2021-01-28': 0.037542662, '2021-01-29': 0.07167422, '2021-01-30': 0.0589, '2021-01-31': 0.030614228, '2021-02-01': 0.038, '2021-02-02': 0.064609107, '2021-02-03': 0.0823, '2021-02-04': 0.0839, '2021-02-05': 0.067836694, '2021-02-06': 0.051628276, '2021-02-07': 0.084459459, '2021-02-08': 0.0857, '2021-02-09': 0.067176366, '2021-02-10': 0.0639, '2021-02-11': 0.066228276, '2021-02-12': 0.0578, '2021-02-13': 0.040924803, '2021-02-14': 0.033154272, '2021-02-15': 0.053940108, '2021-02-16': 0.031264271, '2021-02-17': 0.038, '2021-02-18': 0.060108583, '2021-02-19': 0.0608, '2021-02-20': 0.055675946, '2021-02-21': 0.062359029, '2021-02-22': 0.064281633, '2021-02-23': 0.0654, '2021-02-24': 0.0677, '2021-02-25': 0.070556445, '2021-02-26': 0.0732, '2021-02-27': 0.0749, '2021-02-28': 0.0747, '2021-03-01': 0.071556957, '2021-03-02': 0.066441251, '2021-03-03': 0.065943873, '2021-03-04': 0.0722, '2021-03-05': 0.077887538, '2021-03-06': 0.0761, '2021-03-07': 0.0689, '2021-03-08': 0.060511057, '2021-03-09': 0.055693274, '2021-03-10': 0.0586, '2021-03-11': 0.067138419, '2021-03-12': 0.075153178, '2021-03-13': 0.071817041, '2021-03-14': 0.06, '2021-03-15': 0.0446, '2021-03-16': 0.0298, '2021-03-17': 0.02, '2021-03-18': 0.0194, '2021-03-19': 0.0323, '2021-03-20': 0.063084657, '2021-03-21': 0.092724004, '2021-03-22': 0.060953747, '2021-03-23': 0.0546, '2021-03-24': 0.070761921, '2021-03-25': 0.0783, '2021-03-26': 0.073015188, '2021-03-27': 0.06176564, '2021-03-28': 0.0614, '2021-03-29': 0.068360872, '2021-03-30': 0.0748, '2021-03-31': 0.0788, '2021-04-01': 0.080482897, '2021-04-02': 0.0799, '2021-04-03': 0.078693916, '2021-04-04': 0.0784, '2021-04-05': 0.0787, '2021-04-06': 0.079, '2021-04-07': 0.078592944, '2021-04-08': 0.0779, '2021-04-09': 0.081167779, '2021-04-10': 0.0909, '2021-04-11': 0.097377921, '2021-04-12': 0.0917, '2021-04-13': 0.0788, '2021-04-14': 0.067121479, '2021-04-15': 0.0642, '2021-04-16': 0.074074074, '2021-04-17': 0.089242932, '2021-04-18': 0.078655909, '2021-04-19': 0.0693, '2021-04-20': 0.0684, '2021-04-21': 0.0735, '2021-04-22': 0.0822, '2021-04-23': 0.092, '2021-04-24': 0.1003, '2021-04-25': 0.1048, '2021-04-26': 0.103, '2021-04-27': 0.092252659, '2021-04-28': 0.074398949, '2021-04-29': 0.0663, '2021-04-30': 0.082819247, '2021-05-01': 0.112505347, '2021-05-02': 0.088517036, '2021-05-03': 0.0747, '2021-05-04': 0.085794327, '2021-05-05': 0.100547846, '2021-05-06': 0.084598017, '2021-05-07': 0.098499208, '2021-05-08': 0.105051408, '2021-05-09': 0.090134976, '2021-05-10': 0.0883, '2021-05-11': 0.098477575, '2021-05-12': 0.099447514, '2021-05-13': 0.061112039, '2021-05-14': 0.0299, '2021-05-15': 0.0243, '2021-05-16': 0.050003732, '2021-05-17': 0.088819768, '2021-05-18': 0.069534749, '2021-05-19': 0.0459, '2021-05-20': 0.039852634, '2021-05-21': 0.0523, '2021-05-22': 0.0725, '2021-05-23': 0.087038219, '2021-05-24': 0.092371969, '2021-05-25': 0.1106, '2021-05-26': 0.113840819, '2021-05-27': 0.102585146, '2021-05-28': 0.153365338, '2021-05-29': 0.103562845, '2021-05-30': 0.0651, '2021-05-31': 0.0732, '2021-06-01': 0.117441983, '2021-06-02': 0.157121977, '2021-06-03': 0.133880888, '2021-06-04': 0.200811828, '2021-06-05': 0.098551821, '2021-06-06': 0.0696, '2021-06-07': 0.112043834, '2021-06-08': 0.139039169, '2021-06-09': 0.1578, '2021-06-10': 0.171322225, '2021-06-11': 0.1784, '2021-06-12': 0.191062852, '2021-06-13': 0.218, '2021-06-14': 0.2419, '2021-06-15': 0.239077762, '2021-06-16': 0.2047, '2021-06-17': 0.210208022, '2021-06-18': 0.28745527, '2021-06-19': 0.2919, '2021-06-20': 0.2472, '2021-06-21': 0.233972066, '2021-06-22': 0.276189808, '2021-06-23': 0.252698124, '2021-06-24': 0.2653, '2021-06-25': 0.325025202, '2021-06-26': 0.395, '2021-06-27': 0.418317071, '2021-06-28': 0.3665, '2021-06-29': 0.344821325, '2021-06-30': 0.4299, '2021-07-01': 0.449095499, '2021-07-02': 0.308296943, '2021-07-03': 0.355205185, '2021-07-04': 0.486424238, '2021-07-05': 0.333380198, '2021-07-06': 0.3436, '2021-07-07': 0.438901504, '2021-07-08': 0.445353449, '2021-07-09': 0.504901636, '2021-07-10': 0.4991, '2021-07-11': 0.4668, '2021-07-12': 0.51363668, '2021-07-13': 0.61824098, '2021-07-14': 0.477783496, '2021-07-15': 0.455946779, '2021-07-16': 0.55376487, '2021-07-17': 0.409525148, '2021-07-18': 0.561945722, '2021-07-19': 0.425102635, '2021-07-20': 0.686795078, '2021-07-21': 0.8446, '2021-07-22': 0.7877, '2021-07-23': 0.6269, '2021-07-24': 0.473507349, '2021-07-25': 0.4146, '2021-07-26': 0.4423, '2021-07-27': 0.5247, '2021-07-28': 0.630253525, '2021-07-29': 0.680312605, '2021-07-30': 0.531646917, '2021-07-31': 0.461605585, '2021-08-01': 0.614906434, '2021-08-02': 0.5951, '2021-08-03': 0.4684, '2021-08-04': 0.458769073, '2021-08-05': 0.652484295, '2021-08-06': 0.7098, '2021-08-07': 0.657305718, '2021-08-08': 0.6141, '2021-08-09': 0.564737836, '2021-08-10': 0.4782, '2021-08-11': 0.3959, '2021-08-12': 0.3773, '2021-08-13': 0.481838014, '2021-08-14': 0.623340103, '2021-08-15': 0.474127259, '2021-08-16': 0.598205384, '2021-08-17': 0.7181, '2021-08-18': 0.7151, '2021-08-19': 0.591411926, '2021-08-20': 0.412374771, '2021-08-21': 0.405, '2021-08-22': 0.4996, '2021-08-23': 0.536590057, '2021-08-24': 0.451980428, '2021-08-25': 0.4652, '2021-08-26': 0.494099055, '2021-08-27': 0.4185, '2021-08-28': 0.36261528, '2021-08-29': 0.431942312, '2021-08-30': 0.4692, '2021-08-31': 0.4587, '2021-09-01': 0.440468114, '2021-09-02': 0.434790002, '2021-09-03': 0.4018, '2021-09-04': 0.3517, '2021-09-05': 0.3122, '2021-09-06': 0.311, '2021-09-07': 0.375843856, '2021-09-08': 0.468635699, '2021-09-09': 0.400260443, '2021-09-10': 0.352290571, '2021-09-11': 0.435755102, '2021-09-12': 0.353616454, '2021-09-13': 0.2631, '2021-09-14': 0.2202, '2021-09-15': 0.2146, '2021-09-16': 0.2355, '2021-09-17': 0.2725, '2021-09-18': 0.315, '2021-09-19': 0.3525, '2021-09-20': 0.3744, '2021-09-21': 0.370180651, '2021-09-22': 0.3377, '2021-09-23': 0.308520393, '2021-09-24': 0.311, '2021-09-25': 0.3278, '2021-09-26': 0.3302, '2021-09-27': 0.289452278, '2021-09-28': 0.235279225, '2021-09-29': 0.289410349, '2021-09-30': 0.233446814, '2021-10-01': 0.259206079, '2021-10-02': 0.2908, '2021-10-03': 0.2958, '2021-10-04': 0.2821, '2021-10-05': 0.2577, '2021-10-06': 0.2306, '2021-10-07': 0.208920834, '2021-10-08': 0.1985, '2021-10-09': 0.1969, '2021-10-10': 0.1995, '2021-10-11': 0.201906987, '2021-10-12': 0.2005, '2021-10-13': 0.196, '2021-10-14': 0.1903, '2021-10-15': 0.1851, '2021-10-16': 0.182183133, '2021-10-17': 0.1824, '2021-10-18': 0.182558106, '2021-10-19': 0.1789, '2021-10-20': 0.169188321, '2021-10-21': 0.155123998, '2021-10-22': 0.1477, '2021-10-23': 0.143547951, '2021-10-24': 0.1366, '2021-10-25': 0.1282, '2021-10-26': 0.1215, '2021-10-27': 0.1194, '2021-10-28': 0.12521103, '2021-10-29': 0.133920325, '2021-10-30': 0.118760635, '2021-10-31': 0.0868, '2021-11-01': 0.058, '2021-11-02': 0.053, '2021-11-03': 0.092375164, '2021-11-04': 0.15014881, '2021-11-05': 0.100417014, '2021-11-06': 0.0695, '2021-11-07': 0.078, '2021-11-08': 0.098126041, '2021-11-09': 0.1046, '2021-11-10': 0.081313947, '2021-11-11': 0.0303, '2021-11-12': 0.018157492, '2021-11-13': 0.063218391, '2021-11-14': 0.032107414, '2021-11-15': 0.057618201, '2021-11-16': 0.056553911, '2021-11-17': 0.045798413, '2021-11-18': 0.0389, '2021-11-19': 0.0359, '2021-11-20': 0.0372, '2021-11-21': 0.043191956, '2021-11-22': 0.052364865, '2021-11-23': 0.054295582, '2021-11-24': 0.041773166, '2021-11-25': 0.0469, '2021-11-26': 0.053843297, '2021-11-27': 0.0447, '2021-11-28': 0.056181779, '2021-11-29': 0.090848904, '2021-11-30': 0.052369349, '2021-12-01': 0.077826672, '2021-12-02': 0.0775, '2021-12-03': 0.055454614, '2021-12-04': 0.0514, '2021-12-05': 0.0634, '2021-12-06': 0.078932207, '2021-12-07': 0.0879, '2021-12-08': 0.0897, '2021-12-09': 0.0862, '2021-12-10': 0.0791, '2021-12-11': 0.0704, '2021-12-12': 0.061656213, '2021-12-13': 0.0548, '2021-12-14': 0.051582815, '2021-12-15': 0.0532, '2021-12-16': 0.059, '2021-12-17': 0.067789576, '2021-12-18': 0.0785, '2021-12-19': 0.0898, '2021-12-20': 0.1008, '2021-12-21': 0.1101, '2021-12-22': 0.116744615}

lst_key=[]
lst_value=[]
for key,value in dit.items():
    lst_key.append(key)
    lst_value.append(value)

pyplot.plot(lst_value)
pyplot.show()
x = np.arange(352)
y = np.array(lst_value)
yhat = savgol_filter(y, 81,3)

plt.plot(x, y)
plt.plot(x,yhat, color='red')
plt.show()

xxx = np.arange(352)
yyy = np.array(y)

z1 = np.polyfit(xxx, yyy,15) # 用15次多项式拟合
p1 = np.poly1d(z1) #多项式系数

print(p1) # 在屏幕上打印拟合多项式
yvals=p1(xxx) 

plt.plot(xxx, yyy, '.',label='original values')
plt.plot(xxx, yvals, 'r',label='polyfit values')
plt.xlabel('date')
plt.ylabel('EVI value')
plt.legend(loc='best')
plt.title('polyfitting')
plt.show()

# 极值
num_peak_3 = signal.find_peaks(yvals, distance=10) #distance表极大值点的距离至少大于等于10个水平单位
print(num_peak_3[0])
print('the number of peaks is ' + str(len(num_peak_3[0])))
plt.plot(xxx, yyy, '.',label='original values')
plt.plot(xxx, yvals, 'r',label='polyfit values')
plt.xlabel('date')
plt.ylabel('EVI value')
plt.legend(loc='best')
plt.title('polyfitting')
for ii in range(len(num_peak_3[0])):
    plt.plot(num_peak_3[0][ii], yvals[num_peak_3[0][ii]],'o',markersize=6)
plt.show()

print(yvals[signal.argrelextrema(yvals, np.greater)]) #极大值的y轴, yvals为要求极值的序列
print(signal.argrelextrema(yvals, np.greater))  #极大值的x轴
peak_ind = signal.argrelextrema(yvals,np.greater)[0] #极大值点，改为np.less即可得到极小值点
plt.plot(xxx, yyy, '.',label='original values')
plt.plot(xxx, yvals, 'r',label='polyfit values')
plt.xlabel('date')
plt.ylabel('EVI value')
plt.legend(loc='best')
plt.title('polyfitting')
plt.plot(signal.argrelextrema(yvals,np.greater)[0],yvals[signal.argrelextrema(yvals, np.greater)],'o', color='blue',markersize=7)  #极大值点
plt.plot(signal.argrelextrema(yvals,np.less)[0],yvals[signal.argrelextrema(yvals, np.less)],'o',color='orange', markersize=7)  #极小值点
plt.show()
